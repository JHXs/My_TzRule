##-----------------------------å…¨å±€é…ç½®------------------------########
mode: rule
log-level: info
mixed-port: 7890
port: 7891
socks-port: 7892
redir-port: 7893
tproxy-port: 7894
ipv6: false
allow-lan: true
authentication: # http,socks å…¥å£çš„éªŒè¯ç”¨æˆ·åï¼Œå¯†ç , export ALL_PROXY=socks5://name:password@hostip:port
#  - "ikunji:ikunji"
unified-delay: true
tcp-concurrent: true

geodata-mode: true         #ã€Metaä¸“å±ã€‘ä½¿ç”¨geoip.datæ•°æ®åº“(é»˜è®¤ï¼šfalseä½¿ç”¨mmdbæ•°æ®åº“)
geodata-loader: standard
geo-auto-update: false  # æ˜¯å¦è‡ªåŠ¨æ›´æ–° geodata
geo-update-interval: 48 # æ›´æ–°é—´éš”ï¼Œå•ä½ï¼šå°æ—¶
geox-url:
  geoip: "https://mirror.ghproxy.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip-lite.dat"
  geosite: "https://mirror.ghproxy.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://mirror.ghproxy.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb"
  asn: "https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb"

# æ§åˆ¶é¢æ¿
external-controller: 0.0.0.0:8090     #æ§åˆ¶å™¨ç›‘å¬åœ°å€
secret: "ikunji"                    #æ§åˆ¶å™¨ç™»å½•å¯†ç 
external-ui: "/var/lib/mihomo/ui"   #httpæœåŠ¡è·¯å¾„ï¼Œå¯ä»¥æ”¾é™æ€webç½‘é¡µï¼Œå¦‚yacdçš„æ§åˆ¶é¢æ¿
                                    #å¯é€šè¿‡`http://{{external-controller}}/ui`ç›´æ¥ä½¿ç”¨
external-ui-url: "https://gh-proxy.com/https://github.com/Zephyruso/zashboard/releases/latest/download/dist.zip"

# åŒ¹é…è¿›ç¨‹ always/strict/off
find-process-mode: strict
global-client-fingerprint: chrome
keep-alive-idle: 600
keep-alive-interval: 30

# ç­–ç•¥ç»„é€‰æ‹©å’Œfakeipç¼“å­˜
profile:
  store-selected: true
  store-fake-ip: true

# æµé‡å—…æ¢
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  force-domain:
    - +.v2ex.com
  skip-domain:
    - "Mijia Cloud"
    - "dlg.io.mi.com"
    - "+.push.apple.com"
    - "+.apple.com"

# ä»£ç†æ¨¡å¼
tun:
  # enable: true
  enable: false
  stack: mixed
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true
  # strict-route: true
  exclude-interface:
    - "Tailscale"

# DNSæ¨¡å—
dns:
  enable: true
  prefer-h3: true
  listen: 0.0.0.0:1053
  ipv6: false
  # enhanced-mode: fake-ip # redir-host/fake-ip
  fake-ip-range: 28.0.0.1/8
  # æ¨¡å¼åˆ‡æ¢ whitelist/blacklist
  # é»‘åå•æ¨¡å¼è¡¨ç¤ºå¦‚æœåŒ¹é…æˆåŠŸåˆ™ä¸è¿”å› Fake-IP, ç™½åå•æ¨¡å¼æ—¶åªæœ‰åŒ¹é…æˆåŠŸæ‰è¿”å› Fake-IP
  fake-ip-filter-mode: blacklist
  fake-ip-filter:
    # - "*" # å½“ä½œ redir-host æ¨¡å¼ä½¿ç”¨
    - "+.lan"
    - "+.local"
    - "*.msftconnecttest.com"
  respect-rules: false
  default-nameserver: # é»˜è®¤ DNS, ç”¨äºè§£æ DNS æœåŠ¡å™¨ çš„åŸŸåï¼Œå¿…é¡»ä¸º IP, å¯ä¸ºåŠ å¯† DNS
    - tls://223.5.5.5
    - tls://223.6.6.6
    - system
  proxy-server-nameserver: # ä¸“ç”¨äºèŠ‚ç‚¹åŸŸåè§£æçš„ DNS æœåŠ¡å™¨
    - 'https://223.5.5.5/dns-query#h3=true'
    - 'https://223.6.6.6/dns-query#h3=true'
  # é…ç½®æŸ¥è¯¢åŸŸåä½¿ç”¨çš„ DNS æœåŠ¡å™¨
  nameserver-policy:
    "+.lan,+.in-addr.arpa, rule-set:private_domain,My_Direct,steam@cn,google@cn,jetbrains@cn,category-games@cn,cn_domain":
      - system # ç›´è¿åŸŸåèµ°ç³»ç»ŸDNS
      - tls://223.5.5.5
      - 114.114.114.114
    "rule-set:My_Direct,anti-AD": rcode://success # å¹¿å‘ŠåŸŸåç›´æ¥è¿”å›æˆåŠŸï¼ˆç­‰äºæ‹¦æˆªï¼‰
  nameserver: # å…œåº•DNSï¼Œç”¨äºè§£æåŸºäºIPçš„è§„åˆ™çš„åŸŸåï¼Œå³æ—¢ä¸åœ¨ä»£ç†åŸŸåè§„åˆ™å†…ä¹Ÿä¸åœ¨ç›´è¿åŸŸåè§„åˆ™å†…çš„åŸŸå
    - '8.8.8.8#DNS_OUT' # æŒ‡å®š DNS è¿‡ä»£ç†æŸ¥è¯¢ï¼ŒDNS_OUT ä¸ºç­–ç•¥ç»„åæˆ–èŠ‚ç‚¹å
    - '1.1.1.1#DNS_OUT'
    - 'tls://8.8.8.8#DNS_OUT'
    - 'tls://1.1.1.1#DNS_OUT'

# -----------------------------------èŠ‚ç‚¹é…ç½®---------------------------------------#
## å¾…ä¼šé€šè¿‡è®¢é˜…è¿›æ¥

# --------------------------ç­–ç•¥ç»„é…ç½®-------------------------#
proxy-groups:
  - {name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©, type: select, proxies: [â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸ— è‡ªå»º, ğŸš æœºåœºè‡ªåŠ¨, ğŸ“² ç™½å«–è‡ªåŠ¨, ğŸš æœºåœº, ğŸ“² ç™½å«–, ğŸ¯ å…¨çƒç›´è¿]}
  - {name: â™»ï¸ è‡ªåŠ¨é€‰æ‹©, type: url-test, tolerance: 10, proxies: [ğŸ“² ç™½å«–è‡ªåŠ¨, ğŸ— è‡ªå»º, ğŸš æœºåœºè‡ªåŠ¨]}
  - {name: ğŸš æœºåœº, type: select, use: [xjb]}
  - {name: ğŸ— è‡ªå»º, type: select, tolerance: 10, include-all-proxies: true}
  - {name: ğŸ’¬ AI, type: select, proxies: [ğŸ‡¸ğŸ‡¬ ç‹®åŸ, ğŸ— è‡ªå»º, ğŸš€ èŠ‚ç‚¹é€‰æ‹©, ğŸ‡ºğŸ‡² ç¾å›½, ğŸ‡¯ğŸ‡µ æ—¥æœ¬, ğŸ‡°ğŸ‡· éŸ©å›½]}
  - {name: â“‚ï¸ å¾®è½¯æœåŠ¡, type: select, proxies: [ğŸš€ èŠ‚ç‚¹é€‰æ‹©, ğŸ¯ å…¨çƒç›´è¿]}
  - {name: ğŸ“ è°·æ­Œå­¦æœ¯, type: select, proxies: [ğŸ‡°ğŸ‡· éŸ©å›½, ğŸ— è‡ªå»º, ğŸš€ èŠ‚ç‚¹é€‰æ‹©, ğŸ‡­ğŸ‡° é¦™æ¸¯, ğŸ‡¸ğŸ‡¬ ç‹®åŸ, ğŸ‡ºğŸ‡² ç¾å›½, ğŸ‡¯ğŸ‡µ æ—¥æœ¬]}
  - {name: ğŸš æœºåœºè‡ªåŠ¨, type: url-test, tolerance: 10, use: [xjb]}
  - {name: ğŸ“² ç™½å«–è‡ªåŠ¨, type: url-test, tolerance: 50, use: [ikuuu, freecloud]}
  - {name: ğŸ“² ç™½å«–, type: select, use: [ikuuu, freecloud]}
  - {name: DNS_OUT, type: select, proxies: [ğŸš€ èŠ‚ç‚¹é€‰æ‹©, ğŸ— è‡ªå»º, ğŸ¯ å…¨çƒç›´è¿, ğŸ‡­ğŸ‡° é¦™æ¸¯, ğŸ‡¸ğŸ‡¬ ç‹®åŸ, ğŸ‡ºğŸ‡² ç¾å›½, ğŸ‡¯ğŸ‡µ æ—¥æœ¬, ğŸ‡¸ğŸ‡¬ ç‹®åŸ]}
  - {name: ğŸ¯ å…¨çƒç›´è¿, type: select, proxies: [DIRECT]}
  - {name: ğŸ›‘ å…¨çƒæ‹¦æˆª, type: select, proxies: [REJECT, ğŸ¯ å…¨çƒç›´è¿]}
  - {name: ğŸŸ æ¼ç½‘ä¹‹é±¼, type: select, proxies: [ğŸš€ èŠ‚ç‚¹é€‰æ‹©, ğŸ¯ å…¨çƒç›´è¿, â™»ï¸ è‡ªåŠ¨é€‰æ‹©]}

  # åˆ†éš”,ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  - {name: ğŸ‡­ğŸ‡° é¦™æ¸¯, type: url-test, tolerance: 10, include-all-providers: true, filter: "(?i)æ¸¯|hk|hongkong|hong kong"}
  # - {name: ğŸ‡¨ğŸ‡³ å°æ¹¾, type: url-test, tolerance: 10, include-all-providers: true, filter: "(?i)å°|tw|taiwan"}
  - {name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬, type: select, include-all-providers: true, filter: "(?i)æ—¥|jp|japan"}
  - {name: ğŸ‡ºğŸ‡² ç¾å›½, type: url-test, tolerance: 10, include-all-providers: true, filter: "(?i)ç¾|us|unitedstates|united states"}
  - {name: ğŸ‡¸ğŸ‡¬ ç‹®åŸ, type: select, include-all-providers: true, filter: "(?i)(æ–°|sg|singapore)"}
  - {name: ğŸ‡°ğŸ‡· éŸ©å›½, type: url-test, tolerance: 10, include-all-providers: true, filter: "(?i)(KR|Korea|KOR|é¦–å°”|éŸ©|éŸ“)"}
  - {name: å…¶å®ƒåœ°åŒº, type: url-test, tolerance: 10, include-all-providers: true, filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|ğŸ‡°ğŸ‡·|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates|éŸ©|é¦–å°”|KR|Korea|KOR)).*"}
  # - {name: å…¨éƒ¨èŠ‚ç‚¹, type: select , include-all-providers: true}


# ----------------------------è§„åˆ™é…ç½®-----------------------#
rules:
  # è‡ªå·±è§„åˆ™
  - IP-CIDR,20.205.243.166/32,DIRECT,no-resolve  # é˜»æ­¢ DNS å¹²æ‰°
  - RULE-SET,My_Reject,ğŸ›‘ å…¨çƒæ‹¦æˆª
  - RULE-SET,My_Direct,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,My_Proxy,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  # RULE-SETè§„åˆ™
  - RULE-SET,anti-AD,ğŸ›‘ å…¨çƒæ‹¦æˆª
  - RULE-SET,private_domain,ğŸ¯ å…¨çƒç›´è¿ # å±€åŸŸç½‘åŸŸåç›´è¿
  - RULE-SET,steam@cn,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,cn_domain,ğŸ¯ å…¨çƒç›´è¿

  - RULE-SET,google_scholar,ğŸ“ è°·æ­Œå­¦æœ¯
  - RULE-SET,category-ai-chat-!cn,ğŸ’¬ AI
  - RULE-SET,microsoft_domain,â“‚ï¸ å¾®è½¯æœåŠ¡
  - RULE-SET,telegram_domain,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,geolocation-!cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  - RULE-SET,google_ip,ğŸš€ èŠ‚ç‚¹é€‰æ‹©,no-resolve
  - RULE-SET,netflix_ip,ğŸš€ èŠ‚ç‚¹é€‰æ‹©,no-resolve
  - RULE-SET,telegram_ip,ğŸš€ èŠ‚ç‚¹é€‰æ‹©,no-resolve
  - RULE-SET,private_ip,ğŸ¯ å…¨çƒç›´è¿,no-resolve # å±€åŸŸç½‘ipç›´è¿
  - RULE-SET,cn_ip,ğŸ¯ å…¨çƒç›´è¿

  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼

#----------------------- åœ¨çº¿è§„åˆ™åˆ—è¡¨é…ç½®----------------------#
rule-anchor:
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: mrs}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: mrs}
  classical: &classical {type: http, interval: 86400, behavior: classical, format: text}

rule-providers:
  # è‡ªå·±çš„è§„åˆ™é›†
  My_Reject:
    <<: *classical
    url: https://raw.githubusercontent.com/JHXs/My_TzRule/master/My_Reject.txt
  My_Direct:
    <<: *classical
    url: https://raw.githubusercontent.com/JHXs/My_TzRule/master/My_Direct.txt
  My_Proxy:
    <<: *classical
    url: https://raw.githubusercontent.com/JHXs/My_TzRule/master/My_Proxy.txt

  # domain
  private_domain:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/private.mrs
  anti-AD:
    <<: *domain
    url: https://raw.githubusercontent.com/privacy-protection-tools/anti-ad.github.io/master/docs/mihomo.mrs
  google_scholar: {!!merge <<: *domain, url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/google-scholar.mrs"}
  category-ai-chat-!cn:
    <<: *domain
    url: https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/category-ai-chat-!cn.mrs
  telegram_domain: {!!merge <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/telegram.mrs"}
  microsoft_domain: {!!merge <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/microsoft.mrs"}
  steam@cn:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/steam@cn.mrs
  microsoft@cn:
    <<: *domain
    url: https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/microsoft@cn.mrs
  jetbrains@cn:
    <<: *domain
    url: https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/jetbrains@cn.mrs
  google@cn:
    <<: *domain
    url: https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/google@cn.mrs
  apple@cn:
    <<: *domain
    url: https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/apple@cn.mrs
  category-games@cn:
    <<: *domain
    url: https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/category-games@cn.mrs
  geolocation-!cn:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.mrs
  cn_domain:
    <<: *domain
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.mrs

# ip
  private_ip:
    <<: *ip
    url: https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geoip/private.mrs
  cn_ip:
    <<: *ip
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.mrs
  google_ip: {!!merge <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/google.mrs"}
  telegram_ip: {!!merge <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/telegram.mrs"}
  netflix_ip: {!!merge <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/netflix.mrs"}
